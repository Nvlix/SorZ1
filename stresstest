-- ============================================================
-- JAWIRSCRIPT AUTO FORGE SYSTEM - COMPLETE SETTINGS VERSION
-- ============================================================
-- Dilengkapi dengan semua pengaturan: Slider dan Dropdown untuk setiap fitur
-- ============================================================

-- ... (Semua kode sebelumnya tetap sama sampai bagian createMainWindow) ...

----------------------------------------------------------------
-- ====================== WINDUI GUI DENGAN SETTINGAN LENGKAP ========================
----------------------------------------------------------------

local function toggleGUI()
    if not MainWindow then 
        print("[GUI] MainWindow not created yet")
        return 
    end
    
    if guiVisible then
        MainWindow:Close()
        if MainWindow.OpenButtonMain then
            MainWindow.OpenButtonMain:Visible(true)
        end
        guiVisible = false
        print("[GUI] GUI hidden")
        
        -- Update tombol mobile jika ada
        if MobileToggleButton then
            MobileToggleButton.Text = "üì±\nGUI"
            MobileToggleButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
        end
    else
        MainWindow:Open()
        if MainWindow.OpenButtonMain then
            MainWindow.OpenButtonMain:Visible(false)
        end
        guiVisible = true
        print("[GUI] GUI shown")
        
        -- Update tombol mobile jika ada
        if MobileToggleButton then
            MobileToggleButton.Text = "üì±\nOPEN"
            MobileToggleButton.BackgroundColor3 = Color3.fromRGB(0, 200, 83)
        end
    end
end

local function createMainWindow()
    -- Simple fallback GUI jika WindUI gagal
    local function createFallbackGUI()
        print("[GUI] Creating fallback GUI...")
        
        local ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "JawirScriptFallbackGUI"
        ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
        
        local MainFrame = Instance.new("Frame")
        MainFrame.Size = UDim2.new(0, 350, 0, 500)
        MainFrame.Position = UDim2.new(0.5, -175, 0.5, -250)
        MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
        MainFrame.BorderSizePixel = 0
        MainFrame.Active = true
        MainFrame.Draggable = true
        MainFrame.Visible = guiVisible
        MainFrame.Parent = ScreenGui
        
        -- Buat corner
        local UICorner = Instance.new("UICorner")
        UICorner.CornerRadius = UDim.new(0, 8)
        UICorner.Parent = MainFrame
        
        local Title = Instance.new("TextLabel")
        Title.Size = UDim2.new(1, 0, 0, 40)
        Title.Position = UDim2.new(0, 0, 0, 0)
        Title.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
        Title.Text = "JawirScript - Settings"
        Title.TextColor3 = Color3.fromRGB(255, 255, 255)
        Title.Font = Enum.Font.SourceSansBold
        Title.TextSize = 18
        Title.Parent = MainFrame
        
        local CloseButton = Instance.new("TextButton")
        CloseButton.Size = UDim2.new(0, 30, 0, 30)
        CloseButton.Position = UDim2.new(1, -35, 0, 5)
        CloseButton.Text = "X"
        CloseButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        CloseButton.Font = Enum.Font.SourceSansBold
        CloseButton.TextSize = 18
        CloseButton.Parent = MainFrame
        CloseButton.MouseButton1Click:Connect(function()
            MainFrame.Visible = not MainFrame.Visible
            guiVisible = MainFrame.Visible
            
            -- Update tombol mobile
            if MobileToggleButton then
                if guiVisible then
                    MobileToggleButton.Text = "üì±\nOPEN"
                    MobileToggleButton.BackgroundColor3 = Color3.fromRGB(0, 200, 83)
                else
                    MobileToggleButton.Text = "üì±\nGUI"
                    MobileToggleButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
                end
            end
        end)
        
        -- Buat Tab System sederhana
        local TabButtonsFrame = Instance.new("Frame")
        TabButtonsFrame.Size = UDim2.new(1, 0, 0, 40)
        TabButtonsFrame.Position = UDim2.new(0, 0, 0, 40)
        TabButtonsFrame.BackgroundTransparency = 1
        TabButtonsFrame.Parent = MainFrame
        
        local UIListLayout = Instance.new("UIListLayout")
        UIListLayout.FillDirection = Enum.FillDirection.Horizontal
        UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        UIListLayout.Padding = UDim.new(0, 5)
        UIListLayout.Parent = TabButtonsFrame
        
        local tabs = {"Main", "Mine", "Attack", "ESP", "Forge"}
        local currentTab = "Main"
        local TabContents = {}
        
        -- Buat ScrollFrame untuk konten
        local ScrollFrame = Instance.new("ScrollingFrame")
        ScrollFrame.Size = UDim2.new(1, -10, 1, -90)
        ScrollFrame.Position = UDim2.new(0, 5, 0, 85)
        ScrollFrame.BackgroundTransparency = 1
        ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 800)
        ScrollFrame.ScrollBarThickness = 8
        ScrollFrame.Parent = MainFrame
        
        local ContentListLayout = Instance.new("UIListLayout")
        ContentListLayout.Padding = UDim.new(0, 8)
        ContentListLayout.Parent = ScrollFrame
        
        local function showTab(tabName)
            for _, content in pairs(TabContents) do
                content.Visible = false
            end
            if TabContents[tabName] then
                TabContents[tabName].Visible = true
            end
            currentTab = tabName
        end
        
        -- Buat tombol tab
        for _, tabName in ipairs(tabs) do
            local tabButton = Instance.new("TextButton")
            tabButton.Size = UDim2.new(0, 60, 0, 30)
            tabButton.Text = tabName
            tabButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
            tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            tabButton.Font = Enum.Font.SourceSansSemibold
            tabButton.TextSize = 14
            tabButton.Parent = TabButtonsFrame
            
            local tabCorner = Instance.new("UICorner")
            tabCorner.CornerRadius = UDim.new(0, 6)
            tabCorner.Parent = tabButton
            
            -- Buat frame untuk konten tab
            local tabContent = Instance.new("Frame")
            tabContent.Size = UDim2.new(1, 0, 0, 400)
            tabContent.BackgroundTransparency = 1
            tabContent.Visible = false
            tabContent.Parent = ScrollFrame
            
            TabContents[tabName] = tabContent
            
            tabButton.MouseButton1Click:Connect(function()
                showTab(tabName)
            end)
        end
        
        -- Fungsi untuk membuat slider sederhana
        local function createSlider(parent, title, min, max, defaultValue, callback)
            local sliderFrame = Instance.new("Frame")
            sliderFrame.Size = UDim2.new(1, 0, 0, 60)
            sliderFrame.BackgroundTransparency = 1
            sliderFrame.Parent = parent
            
            local titleLabel = Instance.new("TextLabel")
            titleLabel.Size = UDim2.new(1, 0, 0, 20)
            titleLabel.Text = title
            titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            titleLabel.Font = Enum.Font.SourceSans
            titleLabel.TextSize = 14
            titleLabel.BackgroundTransparency = 1
            titleLabel.Parent = sliderFrame
            
            local valueLabel = Instance.new("TextLabel")
            valueLabel.Size = UDim2.new(1, 0, 0, 20)
            valueLabel.Position = UDim2.new(0, 0, 0, 20)
            valueLabel.Text = tostring(defaultValue)
            valueLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
            valueLabel.Font = Enum.Font.SourceSans
            valueLabel.TextSize = 12
            valueLabel.BackgroundTransparency = 1
            valueLabel.Parent = sliderFrame
            
            local sliderBackground = Instance.new("Frame")
            sliderBackground.Size = UDim2.new(1, 0, 0, 15)
            sliderBackground.Position = UDim2.new(0, 0, 0, 45)
            sliderBackground.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
            sliderBackground.Parent = sliderFrame
            
            local sliderCorner = Instance.new("UICorner")
            sliderCorner.CornerRadius = UDim.new(0, 8)
            sliderCorner.Parent = sliderBackground
            
            local sliderFill = Instance.new("Frame")
            sliderFill.Size = UDim2.new((defaultValue - min) / (max - min), 0, 1, 0)
            sliderFill.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
            sliderFill.Parent = sliderBackground
            
            local fillCorner = Instance.new("UICorner")
            fillCorner.CornerRadius = UDim.new(0, 8)
            fillCorner.Parent = sliderFill
            
            -- Fungsi untuk update slider
            local function updateSlider(value)
                local normalized = (value - min) / (max - min)
                sliderFill.Size = UDim2.new(normalized, 0, 1, 0)
                valueLabel.Text = string.format("%.1f", value)
                callback(value)
            end
            
            -- Interaksi slider
            local dragging = false
            sliderBackground.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = true
                end
            end)
            
            sliderBackground.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                end
            end)
            
            sliderBackground.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local pos = input.Position.X - sliderBackground.AbsolutePosition.X
                    local normalized = math.clamp(pos / sliderBackground.AbsoluteSize.X, 0, 1)
                    local value = min + normalized * (max - min)
                    updateSlider(value)
                end
            end)
            
            updateSlider(defaultValue)
            return sliderFrame
        end
        
        -- Fungsi untuk membuat dropdown sederhana
        local function createDropdown(parent, title, options, defaultValue, callback)
            local dropdownFrame = Instance.new("Frame")
            dropdownFrame.Size = UDim2.new(1, 0, 0, 60)
            dropdownFrame.BackgroundTransparency = 1
            dropdownFrame.Parent = parent
            
            local titleLabel = Instance.new("TextLabel")
            titleLabel.Size = UDim2.new(1, 0, 0, 20)
            titleLabel.Text = title
            titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            titleLabel.Font = Enum.Font.SourceSans
            titleLabel.TextSize = 14
            titleLabel.BackgroundTransparency = 1
            titleLabel.Parent = dropdownFrame
            
            local dropdownButton = Instance.new("TextButton")
            dropdownButton.Size = UDim2.new(1, 0, 0, 30)
            dropdownButton.Position = UDim2.new(0, 0, 0, 25)
            dropdownButton.Text = defaultValue
            dropdownButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
            dropdownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            dropdownButton.Font = Enum.Font.SourceSans
            dropdownButton.TextSize = 14
            dropdownButton.Parent = dropdownFrame
            
            local dropdownCorner = Instance.new("UICorner")
            dropdownCorner.CornerRadius = UDim.new(0, 6)
            dropdownCorner.Parent = dropdownButton
            
            local optionsFrame = Instance.new("Frame")
            optionsFrame.Size = UDim2.new(1, 0, 0, 0)
            optionsFrame.Position = UDim2.new(0, 0, 0, 60)
            optionsFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
            optionsFrame.Visible = false
            optionsFrame.Parent = dropdownFrame
            
            local optionsCorner = Instance.new("UICorner")
            optionsCorner.CornerRadius = UDim.new(0, 6)
            optionsCorner.Parent = optionsFrame
            
            local optionsListLayout = Instance.new("UIListLayout")
            optionsListLayout.Parent = optionsFrame
            
            -- Buat tombol opsi
            for _, option in ipairs(options) do
                local optionButton = Instance.new("TextButton")
                optionButton.Size = UDim2.new(1, 0, 0, 25)
                optionButton.Text = option
                optionButton.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
                optionButton.TextColor3 = Color3.fromRGB(255, 255, 255)
                optionButton.Font = Enum.Font.SourceSans
                optionButton.TextSize = 12
                optionButton.Parent = optionsFrame
                
                optionButton.MouseButton1Click:Connect(function()
                    dropdownButton.Text = option
                    optionsFrame.Visible = false
                    callback(option)
                end)
            end
            
            dropdownButton.MouseButton1Click:Connect(function()
                optionsFrame.Visible = not optionsFrame.Visible
                optionsFrame.Size = UDim2.new(1, 0, 0, #options * 25)
            end)
            
            return dropdownFrame
        end
        
        -- TAB 1: MAIN CONTROLS
        do
            local mainTab = TabContents["Main"]
            
            local buttonStyle = {
                BackgroundColor3 = Color3.fromRGB(60, 60, 70),
                TextColor3 = Color3.fromRGB(255, 255, 255),
                Font = Enum.Font.SourceSansSemibold,
                TextSize = 14
            }
            
            -- Quick Toggles
            local quickToggles = {
                {"‚õèÔ∏è Auto Mine", toggleAutoMine},
                {"‚öîÔ∏è Auto Attack", toggleAutoAttack},
                {"üóø Rock ESP", toggleRockESP},
                {"üëπ Mob ESP", toggleMobESP},
                {"üëª Noclip", toggleNoclip}
            }
            
            for i, toggle in ipairs(quickToggles) do
                local button = Instance.new("TextButton")
                button.Size = UDim2.new(1, -10, 0, 35)
                button.Position = UDim2.new(0, 5, 0, (i-1)*40)
                button.Text = toggle[1]
                for prop, value in pairs(buttonStyle) do
                    button[prop] = value
                end
                button.Parent = mainTab
                
                local corner = Instance.new("UICorner")
                corner.CornerRadius = UDim.new(0, 6)
                corner.Parent = button
                
                button.MouseButton1Click:Connect(function()
                    toggle[2]()
                end)
            end
            
            -- Action Buttons
            local actionButtons = {
                {"üéØ Mine Now", forceMineNearest},
                {"üéØ Attack Now", forceAttackNearest},
                {"üßπ Clean ESP", cleanupESP},
                {"üõë Stop All", function()
                    stopAutoHammer()
                    AutoMineEnabled = false
                    flags.AutoAttackEnabled = false
                    IsMining = false
                    IsAttacking = false
                    disableNoclip()
                end}
            }
            
            for i, action in ipairs(actionButtons) do
                local button = Instance.new("TextButton")
                button.Size = UDim2.new(1, -10, 0, 35)
                button.Position = UDim2.new(0, 5, 0, 200 + (i-1)*40)
                button.Text = action[1]
                for prop, value in pairs(buttonStyle) do
                    button[prop] = value
                end
                button.Parent = mainTab
                
                local corner = Instance.new("UICorner")
                corner.CornerRadius = UDim.new(0, 6)
                corner.Parent = button
                
                button.MouseButton1Click:Connect(function()
                    action[2]()
                end)
            end
        end
        
        -- TAB 2: MINING SETTINGS
        do
            local mineTab = TabContents["Mine"]
            local yPos = 10
            
            -- Mining Speed
            createSlider(mineTab, "‚è© Mining Speed", 10, 500, MINING_SPEED, function(value)
                setMiningSpeed(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Mining Cooldown
            createSlider(mineTab, "‚è≥ Mining Cooldown", 0.5, 5, MINING_COOLDOWN, function(value)
                setMiningCooldown(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Search Radius
            createSlider(mineTab, "üîç Search Radius", 10, 5000, MINING_SEARCH_RADIUS, function(value)
                setSearchRadius(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Fly Height
            createSlider(mineTab, "üïäÔ∏è Fly Height", 0, 100, FLY_HEIGHT, function(value)
                setFlyHeight(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Mining Delay
            createSlider(mineTab, "‚è±Ô∏è Mining Delay", 0.1, 2, MINE_DELAY, function(value)
                setMineDelay(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Rock Type Selection
            local rockTypes = getAllRockTypes()
            table.insert(rockTypes, 1, "Any")
            createDropdown(mineTab, "üóø Rock Type", rockTypes, SelectedRockType, function(value)
                setRockType(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
        end
        
        -- TAB 3: ATTACK SETTINGS
        do
            local attackTab = TabContents["Attack"]
            local yPos = 10
            
            -- Attack Speed
            createSlider(attackTab, "‚ö° Attack Speed", 10, 500, ATTACK_SPEED, function(value)
                setAttackSpeed(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Attack Cooldown
            createSlider(attackTab, "‚è≥ Attack Cooldown", 0.5, 5, ATTACK_COOLDOWN, function(value)
                setAttackCooldown(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Search Radius
            createSlider(attackTab, "üîç Attack Radius", 10, 1000, ATTACK_SEARCH_RADIUS, function(value)
                setAttackSearchRadius(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Attack Delay
            createSlider(attackTab, "‚è±Ô∏è Attack Delay", 0.1, 2, ATTACK_DELAY, function(value)
                setAttackDelay(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Mob Type Selection
            local mobTypes = getAllMobTypes()
            table.insert(mobTypes, 1, "Any")
            createDropdown(attackTab, "üëπ Mob Type", mobTypes, SelectedMobType, function(value)
                setMobType(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Toggle Attack While Mining
            local toggleFrame = Instance.new("Frame")
            toggleFrame.Size = UDim2.new(1, 0, 0, 40)
            toggleFrame.Position = UDim2.new(0, 0, 0, yPos)
            toggleFrame.BackgroundTransparency = 1
            toggleFrame.Parent = attackTab
            
            local toggleButton = Instance.new("TextButton")
            toggleButton.Size = UDim2.new(1, 0, 0, 30)
            toggleButton.Text = "‚öîÔ∏è Attack While Mining: " .. (flags.AttackWhileMining and "ON" or "OFF")
            toggleButton.BackgroundColor3 = flags.AttackWhileMining and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
            toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            toggleButton.Font = Enum.Font.SourceSansSemibold
            toggleButton.TextSize = 14
            toggleButton.Parent = toggleFrame
            
            local toggleCorner = Instance.new("UICorner")
            toggleCorner.CornerRadius = UDim.new(0, 6)
            toggleCorner.Parent = toggleButton
            
            toggleButton.MouseButton1Click:Connect(function()
                flags.AttackWhileMining = not flags.AttackWhileMining
                toggleButton.Text = "‚öîÔ∏è Attack While Mining: " .. (flags.AttackWhileMining and "ON" or "OFF")
                toggleButton.BackgroundColor3 = flags.AttackWhileMining and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
                print("[SETTINGS] Attack while mining: " .. (flags.AttackWhileMining and "ENABLED" or "DISABLED"))
            end)
        end
        
        -- TAB 4: ESP SETTINGS
        do
            local espTab = TabContents["ESP"]
            local yPos = 10
            
            -- Rock ESP Distance
            createSlider(espTab, "üóø Rock ESP Distance", 10, 2000, ESPDistance, function(value)
                setESPDistance(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Mob ESP Distance
            createSlider(espTab, "üëπ Mob ESP Distance", 10, 1000, MobESPDistance, function(value)
                setMobESPDistance(value)
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- ESP Update Interval
            createSlider(espTab, "üîÑ ESP Update Interval", 0.1, 5, ESPUpdateInterval, function(value)
                ESPUpdateInterval = value
                print("[SETTINGS] ESP Update Interval: " .. value .. " seconds")
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Toggle Debug Mode
            local debugFrame = Instance.new("Frame")
            debugFrame.Size = UDim2.new(1, 0, 0, 40)
            debugFrame.Position = UDim2.new(0, 0, 0, yPos)
            debugFrame.BackgroundTransparency = 1
            debugFrame.Parent = espTab
            
            local debugButton = Instance.new("TextButton")
            debugButton.Size = UDim2.new(1, 0, 0, 30)
            debugButton.Text = "üêû Debug Mode: " .. (debugMode and "ON" or "OFF")
            debugButton.BackgroundColor3 = debugMode and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
            debugButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            debugButton.Font = Enum.Font.SourceSansSemibold
            debugButton.TextSize = 14
            debugButton.Parent = debugFrame
            
            local debugCorner = Instance.new("UICorner")
            debugCorner.CornerRadius = UDim.new(0, 6)
            debugCorner.Parent = debugButton
            
            debugButton.MouseButton1Click:Connect(function()
                debugMode = not debugMode
                debugButton.Text = "üêû Debug Mode: " .. (debugMode and "ON" or "OFF")
                debugButton.BackgroundColor3 = debugMode and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
                print("[SETTINGS] Debug mode: " .. (debugMode and "ENABLED" or "DISABLED"))
            end)
        end
        
        -- TAB 5: FORGE SETTINGS
        do
            local forgeTab = TabContents["Forge"]
            local yPos = 10
            
            -- Hammer Cooldown
            createSlider(forgeTab, "üî® Hammer Cooldown", 0.1, 1, HAMMER_COOLDOWN, function(value)
                HAMMER_COOLDOWN = value
                print("[SETTINGS] Hammer cooldown: " .. value .. " seconds")
            end).Position = UDim2.new(0, 0, 0, yPos)
            yPos = yPos + 70
            
            -- Forge Toggles
            local forgeToggles = {
                {"üî® Auto Hammer", "AutoHammerEnabled"},
                {"üî• Skip Melt", "SkipMeltEnabled"},
                {"üíß Skip Pour", "SkipPourEnabled"},
                {"‚öôÔ∏è Auto Initialize", "AutoInitialize"}
            }
            
            for i, toggle in ipairs(forgeToggles) do
                local toggleFrame = Instance.new("Frame")
                toggleFrame.Size = UDim2.new(1, 0, 0, 40)
                toggleFrame.Position = UDim2.new(0, 0, 0, yPos)
                toggleFrame.BackgroundTransparency = 1
                toggleFrame.Parent = forgeTab
                
                local toggleButton = Instance.new("TextButton")
                toggleButton.Size = UDim2.new(1, 0, 0, 30)
                toggleButton.Text = toggle[1] .. ": " .. (flags[toggle[2]] and "ON" or "OFF")
                toggleButton.BackgroundColor3 = flags[toggle[2]] and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
                toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
                toggleButton.Font = Enum.Font.SourceSansSemibold
                toggleButton.TextSize = 14
                toggleButton.Parent = toggleFrame
                
                local toggleCorner = Instance.new("UICorner")
                toggleCorner.CornerRadius = UDim.new(0, 6)
                toggleCorner.Parent = toggleButton
                
                toggleButton.MouseButton1Click:Connect(function()
                    flags[toggle[2]] = not flags[toggle[2]]
                    toggleButton.Text = toggle[1] .. ": " .. (flags[toggle[2]] and "ON" or "OFF")
                    toggleButton.BackgroundColor3 = flags[toggle[2]] and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
                    print("[SETTINGS] " .. toggle[1] .. ": " .. (flags[toggle[2]] and "ENABLED" or "DISABLED"))
                end)
                
                yPos = yPos + 45
            end
            
            -- Activate Hooks Button
            local hookButton = Instance.new("TextButton")
            hookButton.Size = UDim2.new(1, 0, 0, 35)
            hookButton.Position = UDim2.new(0, 0, 0, yPos)
            hookButton.Text = "üîß Activate Forge Hooks"
            hookButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
            hookButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            hookButton.Font = Enum.Font.SourceSansSemibold
            hookButton.TextSize = 14
            hookButton.Parent = forgeTab
            
            local hookCorner = Instance.new("UICorner")
            hookCorner.CornerRadius = UDim.new(0, 6)
            hookCorner.Parent = hookButton
            
            hookButton.MouseButton1Click:Connect(function()
                hookMinigameModules()
            end)
        end
        
        -- Tampilkan tab utama pertama
        showTab("Main")
        
        print("[GUI] Fallback Settings GUI created successfully")
        
        return {
            Open = function() 
                MainFrame.Visible = true 
                guiVisible = true
            end,
            Close = function() 
                MainFrame.Visible = false 
                guiVisible = false
            end,
            OpenButtonMain = {
                Visible = function(visible)
                    -- Do nothing for fallback
                end
            }
        }
    end
    
    -- Coba load WindUI
    if not loadUILibrary() then
        print("[GUI] WindUI failed to load, using fallback GUI")
        MainWindow = createFallbackGUI()
        return MainWindow
    end
    
    print("[GUI] Creating WindUI Window with Complete Settings...")
    
    local success, window = pcall(function()
        return WindUI:CreateWindow({
            Title = "JawirScript - Complete Settings",
            Folder = "JawirScriptSystem",
            Theme = "Dark",
            Size = UDim2.new(0, 450, 0, 550),
            Radius = 12,
            Resizable = true,
            Acrylic = true,
            Background = Color3.fromRGB(30, 30, 35),
            Author = "sora",
            ToggleKey = Enum.KeyCode.RightControl
        })
    end)
    
    if not success then
        print("[GUI] Failed to create WindUI window, using fallback: " .. tostring(window))
        MainWindow = createFallbackGUI()
        return MainWindow
    end
    
    MainWindow = window
    print("[GUI] WindUI Settings Window created successfully")
    
    -- Buat tabs lengkap dengan semua setting
    pcall(function()
        -- Tab 1: Main Controls
        local MainTab = MainWindow:Tab({
            Title = "üì± Main",
            Desc = "Main Controls & Quick Actions"
        })
        
        MainTab:Toggle({
            Title = "‚õèÔ∏è Auto Mine",
            Desc = "Toggle auto mining system",
            Value = AutoMineEnabled,
            Callback = function(value)
                AutoMineEnabled = toggleAutoMine()
            end
        })
        
        MainTab:Toggle({
            Title = "‚öîÔ∏è Auto Attack",
            Desc = "Toggle auto attack system",
            Value = flags.AutoAttackEnabled,
            Callback = function(value)
                flags.AutoAttackEnabled = toggleAutoAttack()
            end
        })
        
        MainTab:Toggle({
            Title = "üëª Noclip",
            Desc = "Toggle noclip during auto actions",
            Value = NOCLIP_ENABLED,
            Callback = function(value)
                NOCLIP_ENABLED = toggleNoclip()
            end
        })
        
        MainTab:Divider()
        
        MainTab:Toggle({
            Title = "üóø Rock ESP",
            Desc = "Toggle rock highlighting",
            Value = ESPEnabled,
            Callback = function(value)
                ESPEnabled = toggleRockESP()
            end
        })
        
        MainTab:Toggle({
            Title = "üëπ Mob ESP",
            Desc = "Toggle mob highlighting",
            Value = MobESPEnabled,
            Callback = function(value)
                MobESPEnabled = toggleMobESP()
            end
        })
        
        MainTab:Divider()
        
        MainTab:Button({
            Title = "üéØ Mine Nearest Rock",
            Desc = "Force mine nearest rock",
            Callback = function()
                forceMineNearest()
            end
        })
        
        MainTab:Button({
            Title = "üéØ Attack Nearest Mob",
            Desc = "Force attack nearest mob",
            Callback = function()
                forceAttackNearest()
            end
        })
        
        MainTab:Button({
            Title = "üßπ Clean ESP",
            Desc = "Remove all ESP highlights",
            Callback = function()
                cleanupESP()
            end
        })
        
        MainTab:Button({
            Title = "üõë Stop All",
            Desc = "Stop all auto systems",
            Callback = function()
                stopAutoHammer()
                AutoMineEnabled = false
                flags.AutoAttackEnabled = false
                IsMining = false
                IsAttacking = false
                disableNoclip()
                print("[SYSTEM] All systems stopped")
            end
        })
        
        -- Tab 2: Mining Settings
        local MineTab = MainWindow:Tab({
            Title = "‚õèÔ∏è Mining",
            Desc = "Mining System Settings"
        })
        
        MineTab:Slider({
            Title = "‚è© Mining Speed",
            Desc = "Speed of movement to rocks",
            Default = MINING_SPEED,
            Min = 10,
            Max = 500,
            Callback = function(value)
                setMiningSpeed(value)
            end
        })
        
        MineTab:Slider({
            Title = "‚è≥ Mining Cooldown",
            Desc = "Delay between mining targets",
            Default = MINING_COOLDOWN,
            Min = 0.5,
            Max = 5,
            Round = 1,
            Callback = function(value)
                setMiningCooldown(value)
            end
        })
        
        MineTab:Slider({
            Title = "üîç Search Radius",
            Desc = "Distance to search for rocks",
            Default = MINING_SEARCH_RADIUS,
            Min = 10,
            Max = 5000,
            Callback = function(value)
                setSearchRadius(value)
            end
        })
        
        MineTab:Slider({
            Title = "üïäÔ∏è Fly Height",
            Desc = "Height to fly above rocks",
            Default = FLY_HEIGHT,
            Min = 0,
            Max = 100,
            Callback = function(value)
                setFlyHeight(value)
            end
        })
        
        MineTab:Slider({
            Title = "‚è±Ô∏è Mining Delay",
            Desc = "Delay between mining hits",
            Default = MINE_DELAY,
            Min = 0.1,
            Max = 2,
            Round = 2,
            Callback = function(value)
                setMineDelay(value)
            end
        })
        
        local rockTypes = getAllRockTypes()
        table.insert(rockTypes, 1, "Any")
        MineTab:Dropdown({
            Title = "üóø Rock Type Filter",
            Desc = "Select specific rock type",
            Default = SelectedRockType,
            Items = rockTypes,
            Callback = function(value)
                setRockType(value)
            end
        })
        
        -- Tab 3: Attack Settings
        local AttackTab = MainWindow:Tab({
            Title = "‚öîÔ∏è Attack",
            Desc = "Attack System Settings"
        })
        
        AttackTab:Slider({
            Title = "‚ö° Attack Speed",
            Desc = "Speed of movement to mobs",
            Default = ATTACK_SPEED,
            Min = 10,
            Max = 500,
            Callback = function(value)
                setAttackSpeed(value)
            end
        })
        
        AttackTab:Slider({
            Title = "‚è≥ Attack Cooldown",
            Desc = "Delay between attacking targets",
            Default = ATTACK_COOLDOWN,
            Min = 0.5,
            Max = 5,
            Round = 1,
            Callback = function(value)
                setAttackCooldown(value)
            end
        })
        
        AttackTab:Slider({
            Title = "üîç Attack Radius",
            Desc = "Distance to search for mobs",
            Default = ATTACK_SEARCH_RADIUS,
            Min = 10,
            Max = 1000,
            Callback = function(value)
                setAttackSearchRadius(value)
            end
        })
        
        AttackTab:Slider({
            Title = "‚è±Ô∏è Attack Delay",
            Desc = "Delay between attack hits",
            Default = ATTACK_DELAY,
            Min = 0.1,
            Max = 2,
            Round = 2,
            Callback = function(value)
                setAttackDelay(value)
            end
        })
        
        local mobTypes = getAllMobTypes()
        table.insert(mobTypes, 1, "Any")
        AttackTab:Dropdown({
            Title = "üëπ Mob Type Filter",
            Desc = "Select specific mob type",
            Default = SelectedMobType,
            Items = mobTypes,
            Callback = function(value)
                setMobType(value)
            end
        })
        
        AttackTab:Toggle({
            Title = "‚öîÔ∏è Attack While Mining",
            Desc = "Attack priority mobs while mining",
            Value = flags.AttackWhileMining,
            Callback = function(value)
                flags.AttackWhileMining = value
                print("[SETTINGS] Attack while mining: " .. (value and "ENABLED" or "DISABLED"))
            end
        })
        
        -- Tab 4: ESP Settings
        local ESPTab = MainWindow:Tab({
            Title = "üëÅÔ∏è ESP",
            Desc = "ESP Visualization Settings"
        })
        
        ESPTab:Slider({
            Title = "üóø Rock ESP Distance",
            Desc = "Maximum distance to show rocks",
            Default = ESPDistance,
            Min = 10,
            Max = 2000,
            Callback = function(value)
                setESPDistance(value)
            end
        })
        
        ESPTab:Slider({
            Title = "üëπ Mob ESP Distance",
            Desc = "Maximum distance to show mobs",
            Default = MobESPDistance,
            Min = 10,
            Max = 1000,
            Callback = function(value)
                setMobESPDistance(value)
            end
        })
        
        ESPTab:Slider({
            Title = "üîÑ ESP Update Interval",
            Desc = "How often ESP updates",
            Default = ESPUpdateInterval,
            Min = 0.1,
            Max = 5,
            Round = 2,
            Callback = function(value)
                ESPUpdateInterval = value
                print("[SETTINGS] ESP Update Interval: " .. value .. " seconds")
            end
        })
        
        ESPTab:Toggle({
            Title = "üêû Debug Mode",
            Desc = "Enable debug logging",
            Value = debugMode,
            Callback = function(value)
                debugMode = value
                print("[SETTINGS] Debug mode: " .. (value and "ENABLED" or "DISABLED"))
            end
        })
        
        -- Tab 5: Forge Settings
        local ForgeTab = MainWindow:Tab({
            Title = "‚öíÔ∏è Forge",
            Desc = "Forge System Settings"
        })
        
        ForgeTab:Slider({
            Title = "üî® Hammer Cooldown",
            Desc = "Delay between hammer hits",
            Default = HAMMER_COOLDOWN,
            Min = 0.1,
            Max = 1,
            Round = 2,
            Callback = function(value)
                HAMMER_COOLDOWN = value
                print("[SETTINGS] Hammer cooldown: " .. value .. " seconds")
            end
        })
        
        ForgeTab:Toggle({
            Title = "üî® Auto Hammer",
            Desc = "Auto complete hammer minigame",
            Value = flags.AutoHammerEnabled,
            Callback = function(value)
                flags.AutoHammerEnabled = value
                print("[SETTINGS] Auto hammer: " .. (value and "ENABLED" or "DISABLED"))
            end
        })
        
        ForgeTab:Toggle({
            Title = "üî• Skip Melt",
            Desc = "Skip melt minigame",
            Value = flags.SkipMeltEnabled,
            Callback = function(value)
                flags.SkipMeltEnabled = value
                print("[SETTINGS] Skip melt: " .. (value and "ENABLED" or "DISABLED"))
            end
        })
        
        ForgeTab:Toggle({
            Title = "üíß Skip Pour",
            Desc = "Skip pour minigame",
            Value = flags.SkipPourEnabled,
            Callback = function(value)
                flags.SkipPourEnabled = value
                print("[SETTINGS] Skip pour: " .. (value and "ENABLED" or "DISABLED"))
            end
        })
        
        ForgeTab:Button({
            Title = "üîß Activate Forge Hooks",
            Desc = "Activate forge minigame hooks",
            Callback = function()
                hookMinigameModules()
            end
        })
        
        ForgeTab:Button({
            Title = "üõë Stop Auto Hammer",
            Desc = "Stop auto hammer immediately",
            Callback = function()
                stopAutoHammer()
            end
        })
        
        print("[GUI] All settings tabs created successfully")
    end)
    
    return MainWindow
end

----------------------------------------------------------------
-- ===================== INITIALIZATION ======================
----------------------------------------------------------------

local function setupEventListeners()
    -- GUI keybind listener untuk PC
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed then
            if input.KeyCode == Enum.KeyCode[toggleKeybind] then
                toggleGUI()
            end
        end
    end)
    
    -- Character added listener for noclip
    LocalPlayer.CharacterAdded:Connect(function(character)
        task.wait(1)
        if (AutoMineEnabled or IsAttacking) and NOCLIP_ENABLED then
            enableNoclip()
        end
    end)
    
    -- Update player blacklist
    for _, player in pairs(Players:GetPlayers()) do
        PlayerBlacklist[player.Name] = true
    end
    
    Players.PlayerAdded:Connect(function(player)
        PlayerBlacklist[player.Name] = true
    end)
    
    Players.PlayerRemoving:Connect(function(player)
        PlayerBlacklist[player.Name] = nil
    end)
end

local function startESPScanning()
    -- Start auto ESP scanning
    if ESPConnection then
        task.cancel(ESPConnection)
        ESPConnection = nil
    end
    
    ESPConnection = task.spawn(function()
        while true do
            pcall(scanForRocks)
            pcall(scanForMobs)
            task.wait(ESPUpdateInterval)
        end
    end)
    print("[ESP] Auto scanning started")
end

local function initializeSystem()
    print("========================================")
    print("JAWIRSCRIPT AUTO FORGE & MINE SYSTEM")
    print("========================================")
    print("Features: Forge Skip + Auto Mine + Auto Attack")
    print("ESP: Hanya deteksi MOB (TIDAK deteksi PLAYER)")
    print("Mobile: Tap üì± button to toggle GUI")
    print("PC: Press RightControl to toggle GUI")
    print("Complete Settings: All features configurable")
    print("========================================")
    
    -- Initialize player blacklist
    for _, player in pairs(Players:GetPlayers()) do
        PlayerBlacklist[player.Name] = true
    end
    
    -- Initialize remotes
    pcall(initializeRemotes)
    
    -- Create GUI
    pcall(createMainWindow)
    
    -- Buat tombol mobile toggle
    pcall(createMobileToggleButton)
    
    -- Setup event listeners
    pcall(setupEventListeners)
    
    -- Start ESP scanning
    pcall(startESPScanning)
    
    -- Auto activate hooks after delay
    task.spawn(function()
        task.wait(5)
        if flags.AutoInitialize then
            pcall(hookMinigameModules)
        end
    end)
    
    -- Auto start attack system after delay
    task.spawn(function()
        task.wait(8)
        if flags.AutoAttackEnabled then
            pcall(startAutoAttackLoop)
        end
    end)
    
    -- Cleanup on player leave
    Players.LocalPlayer.AncestryChanged:Connect(function()
        if not Players.LocalPlayer.Parent then
            pcall(stopAutoHammer)
            pcall(cleanupESP)
            pcall(disableNoclip)
            
            if MineConnection then
                MineConnection:Disconnect()
                MineConnection = nil
            end
            
            if AttackConnection then
                AttackConnection:Disconnect()
                AttackConnection = nil
            end
            
            if ESPConnection then
                task.cancel(ESPConnection)
                ESPConnection = nil
            end
            
            -- Hapus tombol mobile
            if MobileToggleButton then
                MobileToggleButton:Destroy()
                MobileToggleButton = nil
            end
        end
    end)
    
    -- Cleanup on game close
    game:BindToClose(function()
        pcall(stopAutoHammer)
        pcall(cleanupESP)
        pcall(disableNoclip)
        
        -- Hapus tombol mobile
        if MobileToggleButton then
            MobileToggleButton:Destroy()
            MobileToggleButton = nil
        end
    end)
    
    print("[SYSTEM] Initialization complete")
    print("[SYSTEM] Mobile: Tap üì± button to toggle GUI")
    print("[SYSTEM] PC: Press " .. toggleKeybind .. " to toggle GUI")
    print("[SYSTEM] All settings available in GUI")
    print("========================================")
end

-- Start initialization
task.spawn(function()
    task.wait(2)
    print("[SYSTEM] Starting initialization...")
    pcall(initializeSystem)
end)

return {
    -- Forge System
    ActivateHooks = hookMinigameModules,
    StopHammer = stopAutoHammer,
    StartHammer = startAutoHammer,
    
    -- Auto Mine System
    ToggleAutoMine = toggleAutoMine,
    ForceMine = forceMineNearest,
    ToggleNoclip = toggleNoclip,
    SetMiningSpeed = setMiningSpeed,
    SetMiningCooldown = setMiningCooldown,
    SetSearchRadius = setSearchRadius,
    SetFlyHeight = setFlyHeight,
    SetMineDelay = setMineDelay,
    SetRockType = setRockType,
    
    -- Auto Attack System
    ToggleAutoAttack = toggleAutoAttack,
    ForceAttack = forceAttackNearest,
    SetAttackSpeed = setAttackSpeed,
    SetAttackCooldown = setAttackCooldown,
    SetAttackSearchRadius = setAttackSearchRadius,
    SetAttackDelay = setAttackDelay,
    SetMobType = setMobType,
    
    -- ESP System
    ToggleRockESP = toggleRockESP,
    ToggleMobESP = toggleMobESP,
    CleanupESP = cleanupESP,
    SetESPDistance = setESPDistance,
    SetMobESPDistance = setMobESPDistance,
    
    -- GUI
    ToggleGUI = toggleGUI,
    
    -- Mobile
    CreateMobileToggle = createMobileToggleButton,
    
    -- Settings Access
    GetSettings = function()
        return {
            -- Mining Settings
            MiningSpeed = MINING_SPEED,
            MiningCooldown = MINING_COOLDOWN,
            MiningSearchRadius = MINING_SEARCH_RADIUS,
            FlyHeight = FLY_HEIGHT,
            MineDelay = MINE_DELAY,
            SelectedRockType = SelectedRockType,
            
            -- Attack Settings
            AttackSpeed = ATTACK_SPEED,
            AttackCooldown = ATTACK_COOLDOWN,
            AttackSearchRadius = ATTACK_SEARCH_RADIUS,
            AttackDelay = ATTACK_DELAY,
            SelectedMobType = SelectedMobType,
            AttackWhileMining = flags.AttackWhileMining,
            
            -- ESP Settings
            ESPDistance = ESPDistance,
            MobESPDistance = MobESPDistance,
            ESPUpdateInterval = ESPUpdateInterval,
            DebugMode = debugMode,
            
            -- Forge Settings
            HammerCooldown = HAMMER_COOLDOWN,
            AutoHammer = flags.AutoHammerEnabled,
            SkipMelt = flags.SkipMeltEnabled,
            SkipPour = flags.SkipPourEnabled,
            AutoInitialize = flags.AutoInitialize
        }
    end
}
